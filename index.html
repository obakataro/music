<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Discord Style Player V2+</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
:root {
  --bg-tertiary:#202225;
  --bg-secondary:#2f3136;
  --bg-primary:#36393f;
  --text-normal:#dcddde;
  --text-muted:#72767d;
  --accent:#5865F2;
}
*{box-sizing:border-box;margin:0;padding:0;user-select:none}
body{
  font-family:sans-serif;
  background:var(--bg-primary);
  color:var(--text-normal);
  height:100vh;
  display:flex;
  overflow:hidden;
}
.sidebar-servers{
  width:72px;
  background:var(--bg-tertiary);
  display:flex;
  flex-direction:column;
  align-items:center;
  padding-top:12px;
}
.server-icon{
  width:48px;height:48px;
  border-radius:50%;
  background:var(--bg-primary);
  display:flex;align-items:center;justify-content:center;
  margin-bottom:8px;
  cursor:pointer;
  transition:.2s;
}
.server-icon:hover,
.server-icon.active{
  border-radius:30%;
  background:var(--accent);
}
.server-icon.add-btn{color:#3ba55c}
.sidebar-channels{
  width:260px;
  background:var(--bg-secondary);
  display:flex;
  flex-direction:column;
}
.header{
  height:48px;
  padding:0 12px;
  display:flex;
  align-items:center;
  gap:8px;
  box-shadow:0 1px 0 rgba(0,0,0,.2);
}
.header input{
  flex:1;
  background:#1e1f22;
  border:none;
  color:#fff;
  padding:6px 8px;
  border-radius:4px;
}
.channel-list{flex:1;padding:8px;overflow-y:auto}
.channel-item{
  padding:6px 8px;
  margin:2px 0;
  border-radius:4px;
  cursor:pointer;
  font-size:14px;
  color:var(--text-muted);
}
.channel-item:hover{background:rgba(79,84,92,.32);color:#fff}
.channel-item.playing{background:rgba(79,84,92,.6);color:#fff}
.user-area{background:#292b2f;padding:8px}
.control-buttons{
  display:flex;
  justify-content:center;
  gap:14px;
  margin-bottom:8px;
}
.control-btn{
  background:none;
  border:none;
  color:#fff;
  font-size:18px;
  cursor:pointer;
}
.control-btn.active{color:var(--accent)}
input[type=range]{width:100%}
.main-content{
  flex:1;
  display:flex;
  justify-content:center;
  align-items:center;
  flex-direction:column;
}
.album-art{
  width:200px;height:200px;
  background:#202225;
  border-radius:8px;
  display:flex;align-items:center;justify-content:center;
  font-size:48px;
  margin-bottom:16px;
}
.track-title{
  font-size:20px;
  margin-bottom:8px;
  cursor:text;
}
canvas{width:100%;max-width:600px;height:120px}
#hidden-file-input{position:absolute;left:-9999px}
</style>
</head>

<body>

<div class="sidebar-servers">
  <div class="server-icon active"><i class="fa-brands fa-discord"></i></div>
  <label for="hidden-file-input" class="server-icon add-btn"><i class="fa-solid fa-plus"></i></label>
</div>

<div class="sidebar-channels">
  <div class="header">
    <i class="fa-solid fa-magnifying-glass"></i>
    <input id="search" placeholder="Search">
  </div>
  <div class="channel-list" id="playlist"></div>
  <div class="user-area">
    <div class="control-buttons">
      <button class="control-btn" id="shuffle"><i class="fa-solid fa-shuffle"></i></button>
      <button class="control-btn" id="prev"><i class="fa-solid fa-backward-step"></i></button>
      <button class="control-btn" id="play"><i class="fa-solid fa-play"></i></button>
      <button class="control-btn" id="next"><i class="fa-solid fa-forward-step"></i></button>
      <button class="control-btn" id="loop"><i class="fa-solid fa-repeat"></i></button>
    </div>
    <input type="range" id="seek" value="0">
  </div>
</div>

<div class="main-content">
  <div class="album-art"><i class="fa-solid fa-music"></i></div>
  <div class="track-title" id="title">No Track</div>
  <canvas id="viz"></canvas>
</div>

<input type="file" id="hidden-file-input" multiple accept="audio/*">

<script>
const fileInput=document.getElementById("hidden-file-input");
const playlistEl=document.getElementById("playlist");
const playBtn=document.getElementById("play");
const nextBtn=document.getElementById("next");
const prevBtn=document.getElementById("prev");
const loopBtn=document.getElementById("loop");
const shuffleBtn=document.getElementById("shuffle");
const seek=document.getElementById("seek");
const titleEl=document.getElementById("title");
const search=document.getElementById("search");
const canvas=document.getElementById("viz");
const ctx=canvas.getContext("2d");

let audio=new Audio();
let tracks=[];
let current=0;
let loopMode="off";     // off | track | server
let shuffleMode="off"; // off | server | global

fileInput.onchange=e=>{
  [...e.target.files].forEach(f=>{
    tracks.push({
      file:f,
      name:f.name,
      display:f.name,
      url:URL.createObjectURL(f)
    });
  });
  render();
};

function render(){
  playlistEl.innerHTML="";
  tracks
    .filter(t=>t.display.toLowerCase().includes(search.value.toLowerCase()))
    .forEach((t,i)=>{
      const d=document.createElement("div");
      d.className="channel-item"+(i===current?" playing":"");
      d.textContent=t.display;
      d.onclick=()=>load(i,true);
      d.ondblclick=()=>rename(i);
      playlistEl.appendChild(d);
    });
}

function rename(i){
  const name=prompt("タイトルを編集",tracks[i].display);
  if(name){tracks[i].display=name;render();}
}

function load(i,play){
  current=i;
  audio.src=tracks[i].url;
  titleEl.textContent=tracks[i].display;
  render();
  if(play) audio.play();
}

playBtn.onclick=()=>audio.paused?audio.play():audio.pause();
nextBtn.onclick=()=>next();
prevBtn.onclick=()=>load((current-1+tracks.length)%tracks.length,true);

function next(){
  if(shuffleMode!=="off"){
    load(Math.floor(Math.random()*tracks.length),true);
  }else{
    load((current+1)%tracks.length,true);
  }
}

audio.onended=()=>{
  if(loopMode==="track"){audio.currentTime=0;audio.play();}
  else if(loopMode==="server"){next();}
};

loopBtn.onclick=()=>{
  loopMode=loopMode==="off"?"track":loopMode==="track"?"server":"off";
  loopBtn.classList.toggle("active",loopMode!=="off");
};

shuffleBtn.onclick=()=>{
  shuffleMode=shuffleMode==="off"?"server":"off";
  shuffleBtn.classList.toggle("active",shuffleMode!=="off");
};

search.oninput=render;

audio.ontimeupdate=()=>{
  if(audio.duration) seek.value=audio.currentTime/audio.duration*100;
};
seek.oninput=()=>audio.currentTime=seek.value/100*audio.duration;

canvas.width=600;
</script>

</body>
</html>
